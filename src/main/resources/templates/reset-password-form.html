<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" th:href="@{/images/icon.png}">
    <title>Redefinir Senha - TeamTacles</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #232323;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 0;
            box-sizing: border-box;
        }

        .form-card {
            background: #3C3C3C;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            max-width: 400px;
            width: 100%;
            padding: 30px;
            text-align: center;
        }

        .logo {
            width: 130px;
            height: 100px;
            margin-bottom: 20px;
        }

        h1 {
            color: #ffffff;
            font-size: 18px;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .email-display {
            color: #cccccc;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            color: #A9D6C6;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            background-color: #2E2E2E;
            border: 1px solid #555;
            border-radius: 8px;
            font-size: 16px;
            color: #ffffff;
            box-sizing: border-box;
        }

        input[type="password"]:focus {
            outline: none;
            border-color: #A9D6C6;
        }

        input[type="password"].error {
            border-color: #ff4444;
        }

        .btn {
            background-color: #EB5F1C;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #d54e15;
        }

        .btn:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        .alert-error {
            background: #ffebee;
            color: #c62828;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .error-message {
            color: #ff4444;
            font-size: 12px;
            margin-top: 5px;
            text-align: left;
        }

        .expired-container {
            text-align: center;
        }

        .expired-icon {
            font-size: 60px;
            margin-bottom: 10px;
        }

        .password-requirements {
            color: #888;
            font-size: 12px;
            margin-top: 5px;
            text-align: left;
        }
    </style>
</head>
<body>
<div class="form-card">
    <img th:src="@{/images/logo.png}" alt="TeamTacles Logo" class="logo"/>

    <div th:if="${expired}" class="expired-container">
        <div class="expired-icon">⏱️</div>
        <h1 th:text="${error}">Link Inválido</h1>
    </div>

    <div th:unless="${expired}">
        <h1>Redefinir Senha</h1>
        <p class="email-display">
            Criando nova senha para <strong th:text="${email}"></strong>
        </p>

        <div class="alert-error" th:if="${error}" th:text="${error}"></div>

        <form method="POST" th:action="@{/forgot-password-web}" id="resetPasswordForm" onsubmit="return validateForm()">
            <input type="hidden" name="token" th:value="${token}">

            <div class="form-group">
                <label for="newPassword">Nova Senha</label>
                <input
                        type="password"
                        id="newPassword"
                        name="newPassword"
                        required
                        minlength="6"
                        placeholder="******">
                <div class="password-requirements">Mínimo de 6 caracteres</div>
                <div id="newPasswordError" class="error-message"></div>
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirmar Senha</label>
                <input
                        type="password"
                        id="confirmPassword"
                        name="confirmPassword"
                        required
                        minlength="6"
                        placeholder="******">
                <div id="confirmPasswordError" class="error-message"></div>
            </div>

            <button type="submit" class="btn" id="submitBtn">Salvar Nova Senha</button>
        </form>
    </div>
</div>

<script>
    const newPasswordInput = document.getElementById('newPassword');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const newPasswordError = document.getElementById('newPasswordError');
    const confirmPasswordError = document.getElementById('confirmPasswordError');
    const submitBtn = document.getElementById('submitBtn');

    // Validação em tempo real quando o usuário digita
    confirmPasswordInput.addEventListener('input', function() {
        validatePasswordMatch();
    });

    newPasswordInput.addEventListener('input', function() {
        validatePasswordLength();
        if (confirmPasswordInput.value) {
            validatePasswordMatch();
        }
    });

    function validatePasswordLength() {
        const password = newPasswordInput.value;

        if (password.length > 0 && password.length < 6) {
            newPasswordError.textContent = '⚠️ A senha deve ter pelo menos 6 caracteres';
            newPasswordInput.classList.add('error');
            return false;
        } else {
            newPasswordError.textContent = '';
            newPasswordInput.classList.remove('error');
            return true;
        }
    }

    function validatePasswordMatch() {
        const password = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (confirmPassword.length > 0 && password !== confirmPassword) {
            confirmPasswordError.textContent = '⚠️ As senhas não coincidem';
            confirmPasswordInput.classList.add('error');
            return false;
        } else {
            confirmPasswordError.textContent = '';
            confirmPasswordInput.classList.remove('error');
            return true;
        }
    }

    function validateForm() {
        const password = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        newPasswordError.textContent = '';
        confirmPasswordError.textContent = '';
        newPasswordInput.classList.remove('error');
        confirmPasswordInput.classList.remove('error');

        let isValid = true;

        if (!password || !confirmPassword) {
            alert('Por favor, preencha todos os campos.');
            return false;
        }

        if (password.length < 6) {
            newPasswordError.textContent = '⚠️ A senha deve ter pelo menos 6 caracteres';
            newPasswordInput.classList.add('error');
            isValid = false;
        }

        if (password !== confirmPassword) {
            confirmPasswordError.textContent = '⚠️ As senhas não coincidem';
            confirmPasswordInput.classList.add('error');
            isValid = false;
        }

        if (!isValid) {
            return false;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Salvando...';

        return true;
    }
</script>
</body>
</html>