<!DOCTYPE html>
<html lang="pt" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Relatório do Projeto</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&amp;display=swap');

        body, html {
            font-family: 'Roboto', Arial, sans-serif;
            font-size: 11px;
            color: #333;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
        }

        .page-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            box-sizing: border-box;
        }

        .header-table {
            width: 100%;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        .header-logo-cell {
            width: 70px;
        }
        .logo {
            width: 80px;
            height: auto;
        }
        .project-title {
            font-size: 28px;
            font-weight: 700;
            text-align: right;
            color: #000000;
        }
        .meta-info {
            font-size: 11px;
            color: #7f8c8d;
            text-align: right;
            padding-top: 5px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            color: #000000;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        .description {
            line-height: 1.6;
            margin-bottom: 20px;
        }

        hr {
            border: 0;
            height: 1px;
            background-color: #e0e0e0;
            margin: 30px 0;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            text-align: center;
        }
        .summary-box {
            width: 25%;
            padding: 15px 10px;
        }
        .summary-count {
            display: block;
            font-size: 28px;
            font-weight: 700;
        }
        .summary-label {
            font-size: 11px;
            color: #7f8c8d;
            text-transform: uppercase;
        }
        .summary-done { color: #2ecc71; }
        .summary-in-progress { color: #3498db; }
        .summary-todo { color: #f1c40f; }
        .summary-overdue { color: #e74c3c; }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ecf0f1;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .data-table th, .data-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        .data-table thead {
            background-color: #f2f2f2;
            color: #34495e;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 500;
        }
        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .task-card {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid;
            border-radius: 8px;
            break-inside: avoid;
            page-break-inside: avoid;
        }
        .task-title {
            font-size: 20px;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .task-container-layout {
            display: table;
            width: 100%;
        }
        .task-section {
            display: table-cell;
            vertical-align: top;
        }
        .description-section {
            width: 60%;
        }
        .date-section {
            width: 50%;
        }
        .vertical-divider {
            width: 20px;
            height: 45px;
            border-right: 2px solid #e0e0e0;
            margin: 20px 20px;
        }

        .border-done { border-color: #2ecc71; }
        .border-in-progress { border-color: #3498db; }
        .border-todo { border-color: #f1c40f; }
        .border-overdue { border-color: #e74c3c; }
        .border-default { border-color: #ecf0f1; }

        .footer {
            text-align: center;
            font-size: 10px;
            color: #aaa;
            width: 100%;
            padding-top: 20px;
            margin-top: 40px;
            border-top: 1px solid #e0e0e0;
        }
    </style>
</head>
<body>
<div class="page-container">
    <table class="header-table">
        <tr>
            <td class="header-logo-cell">
                <img th:src="${logoUrl}" alt="Logo" class="logo"/>
            </td>
            <td>
                <div class="project-title" th:text="${project.title}">Nome do Projeto</div>
                <div class="meta-info">
                    <strong>Criado em:</strong> <span th:text="${#temporals.format(project.createdAt, 'dd/MM/yyyy')}">Data</span> |
                    <strong>Dono:</strong> <span th:text="${project.owner.username}">Dono</span>
                </div>
                <div th:if="${taskFilter != null}" class="meta-info">
                    <th:block th:if="${taskFilter.status != null or taskFilter.updatedAtAfter != null or taskFilter.updatedAtBefore != null}">
                        <strong>Filtros:</strong>
                        <span th:if="${taskFilter.status != null}">
                            Estado =
                            <span th:switch="${taskFilter.status.name()}">
                                <span th:case="'DONE'">Concluído</span>
                                <span th:case="'IN_PROGRESS'">Em Progresso</span>
                                <span th:case="'TO_DO'">A Fazer</span>
                                <span th:case="'OVERDUE'">Atrasado</span>
                                <span th:case="*">N/A</span>
                            </span>
                        </span>
                        <span th:if="${taskFilter.updatedAtAfter != null}" th:text="' De: ' + ${#temporals.format(taskFilter.updatedAtAfter, 'dd/MM/yyyy')}"></span>
                        <span th:if="${taskFilter.updatedAtBefore != null}" th:text="' Até: ' + ${#temporals.format(taskFilter.updatedAtBefore, 'dd/MM/yyyy')}"></span>
                    </th:block>
                </div>
            </td>
        </tr>
    </table>

    <div class="section-title">Descrição do Projeto</div>
    <p class="description" th:text="${project.description}">Descrição do projeto aqui.</p>

    <hr/>

    <div class="section-title">Resumo Geral - Tarefas</div>
    <table class="summary-table">
        <tr>
            <td class="summary-box">
                <span class="summary-count summary-done" th:text="${summary.doneCount}">0</span>
                <span class="summary-label">Concluídas</span>
            </td>
            <td class="summary-box">
                <span class="summary-count summary-in-progress" th:text="${summary.inProgressCount}">0</span>
                <span class="summary-label">Em Progresso</span>
            </td>
            <td class="summary-box">
                <span class="summary-count summary-todo" th:text="${summary.toDoCount}">0</span>
                <span class="summary-label">A Fazer</span>
            </td>
            <td class="summary-box">
                <span class="summary-count summary-overdue" th:text="${summary.overdueCount}">0</span>
                <span class="summary-label">Atrasadas</span>
            </td>
        </tr>
    </table>

    <hr/>

    <div class="section-title">Membros</div>
    <table class="data-table">
        <thead>
        <tr>
            <th>Nome de Usuário</th>
            <th>Email</th>
            <th>Função</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="member : ${membersSorted}">
            <td th:text="${member.user.username}">username</td>
            <td th:text="${member.user.email}">email</td>
            <td>
                <span th:switch="${member.projectRole.name()}">
                    <span th:case="'OWNER'">Dono</span>
                    <span th:case="'ADMIN'">Administrador</span>
                    <span th:case="'MEMBER'">Membro</span>
                </span>
            </td>
        </tr>
        </tbody>
    </table>

    <hr/>

    <div class="section-title">Tarefas</div>
    <div th:each="task : ${tasks}">
        <div th:if="${task != null}">
            <div th:replace="~{:: taskCard(task=${task})}"></div>
        </div>
    </div>

    <div class="footer">
        Relatório gerado por TeamTacles em <span th:text="${#temporals.format(generationDate, 'dd/MM/yyyy HH:mm')}"></span>
    </div>
</div>

<div th:fragment="taskCard(task)" th:with="statusStr=${(task != null and task.status != null) ? task.status.name() : 'DEFAULT'}">
    <div th:switch="${statusStr}">
        <div th:case="'DONE'" class="task-card border-done">
            <div th:replace="~{:: taskContent(task=${task}, statusStr=${statusStr})}"></div>
        </div>
        <div th:case="'IN_PROGRESS'" class="task-card border-in-progress">
            <div th:replace="~{:: taskContent(task=${task}, statusStr=${statusStr})}"></div>
        </div>
        <div th:case="'TO_DO'" class="task-card border-todo">
            <div th:replace="~{:: taskContent(task=${task}, statusStr=${statusStr})}"></div>
        </div>
        <div th:case="'OVERDUE'" class="task-card border-overdue">
            <div th:replace="~{:: taskContent(task=${task}, statusStr=${statusStr})}"></div>
        </div>
        <div th:case="*" class="task-card border-default">
            <div th:replace="~{:: taskContent(task=${task}, statusStr=${statusStr})}"></div>
        </div>
    </div>
</div>

<div th:fragment="taskContent(task, statusStr)">
    <div th:if="${task != null}">
        <h3 class="task-title" th:text="${task.title}">Título da Tarefa</h3>
        <div class="task-container-layout">
            <div class="task-section description-section">
                <p><strong>Responsáveis:</strong>
                    <span th:if="${task.assignments != null}" th:each="assignment, iterStat : ${task.assignments}" th:text="${assignment.user.username} + (${iterStat.last} ? '' : ', ')"></span>
                </p>
                <p><strong>Descrição:</strong>
                    <span th:text="${task.description}">Descrição da Tarefa</span>
                </p>
            </div>
            <div class="vertical-divider"></div>
            <div class="task-section date-section">
                <p><strong>Status:</strong>
                    <span th:switch="${statusStr}">
                        <span th:case="'DONE'">Concluído</span>
                        <span th:case="'IN_PROGRESS'">Em Progresso</span>
                        <span th:case="'TO_DO'">A Fazer</span>
                        <span th:case="'OVERDUE'">Atrasado</span>
                        <span th:case="*">N/A</span>
                    </span>
                </p>
                <p><strong>Data de Entrega:</strong> <span th:text="${task.dueDate != null ? #temporals.format(task.dueDate, 'dd/MM/yyyy') : 'N/A'}">Data</span></p>
                <p><strong>Concluído em:</strong> <span th:text="${task.completedAt != null ? #temporals.format(task.completedAt, 'dd/MM/yyyy') : '-----'}">Data</span></p>
            </div>
        </div>
    </div>
</div>

</body>
</html>
